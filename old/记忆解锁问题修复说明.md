# è®°å¿†è§£é”é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
è®°å¿†ç‰‡æ®µæ²¡æœ‰è¢«è§£é”çš„ä¸»è¦åŸå› æ˜¯**æ•°æ®æ ¼å¼ä¸åŒ¹é…**å’Œ**æ¡ä»¶æ£€æŸ¥é€»è¾‘ä¸å®Œæ•´**ï¼š

1. **æ•°æ®æ ¼å¼ä¸åŒ¹é…**
   - è®°å¿†ç‰‡æ®µæ•°æ®ä¸­çš„ `unlock_conditions` æ˜¯**å¯¹è±¡æ ¼å¼**
   - è®°å¿†æœåŠ¡æœŸæœ›çš„æ˜¯**æ•°ç»„æ ¼å¼**
   - å¯¼è‡´æ¡ä»¶è§£æå¤±è´¥

2. **æ¡ä»¶ç±»å‹ä¸æ”¯æŒ**
   - åŸæœ‰çš„æ¡ä»¶æ£€æŸ¥åªæ”¯æŒæœ‰é™çš„æ¡ä»¶ç±»å‹
   - ç¼ºå°‘å¯¹å¥½æ„Ÿåº¦ã€é€‰æ‹©æ¬¡æ•°ç­‰å…³é”®æ¡ä»¶çš„æ”¯æŒ

3. **ç»Ÿè®¡æ•°æ®ä¸å®Œæ•´**
   - `getSessionStats` æ–¹æ³•è¿”å›çš„æ•°æ®ä¸åŒ…å«è§£é”æ¡ä»¶æ‰€éœ€çš„ç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ å¯¹è±¡æ ¼å¼æ¡ä»¶æ£€æŸ¥
æ–°å¢ `checkObjectUnlockConditions` æ–¹æ³•ï¼Œæ”¯æŒä»¥ä¸‹æ¡ä»¶ç±»å‹ï¼š

- âœ… `conversation_count` - å¯¹è¯æ¬¡æ•°
- âœ… `choice_count` - é€‰æ‹©æ¬¡æ•°  
- âœ… `demon_affinity` - æ¶é­”å¥½æ„Ÿåº¦
- âœ… `angel_affinity` - å¤©ä½¿å¥½æ„Ÿåº¦
- âœ… `corruption_value` - å •è½å€¼
- âœ… `purity_value` - çº¯æ´å€¼
- âœ… `demon_choices` - æ¶é­”é€‰æ‹©æ¬¡æ•°
- âœ… `angel_choices` - å¤©ä½¿é€‰æ‹©æ¬¡æ•°
- âœ… `specific_choices` - ç‰¹å®šé€‰æ‹©
- âœ… `time_played` - æ¸¸æˆæ—¶é•¿
- âœ… `emotion` - æƒ…æ„Ÿæ¡ä»¶
- âœ… `keywords` - å…³é”®è¯æ¡ä»¶
- âœ… `time_of_day` - æ—¶é—´æ¡ä»¶

### 2. å¢å¼ºç»Ÿè®¡æ•°æ®æ”¶é›†
æ›´æ–° `getSessionStats` æ–¹æ³•ï¼Œè¿”å›å®Œæ•´çš„ä¼šè¯ç»Ÿè®¡ï¼š

```typescript
{
  messageCount: number,        // æ¶ˆæ¯æ•°é‡
  choiceCount: number,         // é€‰æ‹©æ¬¡æ•°
  demonAffinity: number,       // æ¶é­”å¥½æ„Ÿåº¦
  angelAffinity: number,       // å¤©ä½¿å¥½æ„Ÿåº¦
  corruptionValue: number,     // å •è½å€¼
  purityValue: number,         // çº¯æ´å€¼
  demonChoices: number,        // æ¶é­”é€‰æ‹©æ¬¡æ•°
  angelChoices: number,        // å¤©ä½¿é€‰æ‹©æ¬¡æ•°
  userChoices: string[],       // ç”¨æˆ·é€‰æ‹©å†å²
  timePlayed: number,          // æ¸¸æˆæ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  personalitySwitchCount: number, // äººæ ¼åˆ‡æ¢æ¬¡æ•°
  emotions: Record<string, number>, // æƒ…æ„Ÿåˆ†ææ•°æ®
  session: any                 // ä¼šè¯ä¿¡æ¯
}
```

### 3. ä¿®å¤æ¡ä»¶æ£€æŸ¥æµç¨‹
æ›´æ–° `checkMemoryUnlock` æ–¹æ³•ï¼š

- å°†æ¡ä»¶è§£æä»æ•°ç»„æ ¼å¼æ”¹ä¸ºå¯¹è±¡æ ¼å¼
- è°ƒç”¨æ–°çš„ `checkObjectUnlockConditions` æ–¹æ³•
- ç¡®ä¿æ‰€æœ‰æ¡ä»¶éƒ½èƒ½æ­£ç¡®è¯„ä¼°

## ğŸ“‹ è®°å¿†ç‰‡æ®µæ¡ä»¶ç¤ºä¾‹

### A1 - åˆæ¬¡ç›¸é‡
```json
{
  "conversation_count": 1
}
```

### A2 - å­¦ä¼šå€¾å¬  
```json
{
  "conversation_count": 5,
  "choice_count": 1
}
```

### A3 - ç¬¬ä¸€æ¬¡ç¬‘å£°
```json
{
  "conversation_count": 3,
  "demon_affinity": 10
}
```

### B1 - æ¶é­”çš„è¯±æƒ‘
```json
{
  "conversation_count": 10,
  "demon_affinity": 30,
  "choice_count": 3
}
```

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ¡ä»¶æ£€æŸ¥é€»è¾‘
```typescript
// æ£€æŸ¥å¯¹è¯æ¬¡æ•°
if (conditions.conversation_count !== undefined) {
  const conversationCount = context.sessionStats.messageCount || 0
  if (conversationCount < conditions.conversation_count) {
    return false
  }
}

// æ£€æŸ¥å¥½æ„Ÿåº¦
if (conditions.demon_affinity !== undefined) {
  const demonAffinity = context.sessionStats.demonAffinity || 0
  if (demonAffinity < conditions.demon_affinity) {
    return false
  }
}
```

### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- æ·»åŠ æƒ…ç»ªåˆ†ææ•°æ®èšåˆ
- è®¡ç®—ä¼šè¯æ—¶é•¿
- ç»Ÿè®¡äººæ ¼åˆ‡æ¢æ¬¡æ•°
- ä¸ºæœªæ¥çš„å¥½æ„Ÿåº¦å’Œé€‰æ‹©ç³»ç»Ÿé¢„ç•™æ¥å£

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¥½æ„Ÿåº¦ç³»ç»Ÿ**ï¼šå½“å‰å¥½æ„Ÿåº¦ç›¸å…³å­—æ®µæš‚æ—¶è®¾ä¸ºé»˜è®¤å€¼ï¼Œéœ€è¦åœ¨å¥½æ„Ÿåº¦ç³»ç»Ÿå®ç°åæ›´æ–°

2. **é€‰æ‹©ç³»ç»Ÿ**ï¼šé€‰æ‹©ç›¸å…³ç»Ÿè®¡æš‚æ—¶è®¾ä¸ºé»˜è®¤å€¼ï¼Œéœ€è¦åœ¨é€‰æ‹©ç³»ç»Ÿå®ç°åæ›´æ–°

3. **å‘åå…¼å®¹**ï¼šä¿ç•™äº†åŸæœ‰çš„æ•°ç»„æ ¼å¼æ¡ä»¶æ£€æŸ¥æ–¹æ³•ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§

4. **æ€§èƒ½è€ƒè™‘**ï¼šæ–°å¢çš„ç»Ÿè®¡æŸ¥è¯¢å¯èƒ½å½±å“æ€§èƒ½ï¼Œå»ºè®®æ·»åŠ é€‚å½“çš„æ•°æ®åº“ç´¢å¼•

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œè®°å¿†è§£é”ç³»ç»Ÿå°†èƒ½å¤Ÿï¼š

- âœ… æ­£ç¡®è§£æå¯¹è±¡æ ¼å¼çš„è§£é”æ¡ä»¶
- âœ… æ”¯æŒæ‰€æœ‰å®šä¹‰çš„æ¡ä»¶ç±»å‹
- âœ… å‡†ç¡®ç»Ÿè®¡ä¼šè¯æ•°æ®
- âœ… å®æ—¶æ£€æŸ¥è§£é”æ¡ä»¶
- âœ… æä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

è¿™å°†ç¡®ä¿è®°å¿†å›¾é‰´ç³»ç»ŸæŒ‰ç…§è®¾è®¡æ–‡æ¡£æ­£å¸¸å·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›æµç•…çš„è®°å¿†è§£é”ä½“éªŒã€‚